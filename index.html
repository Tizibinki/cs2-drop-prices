<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>CS2 Drop Prices</title>
	<link rel="stylesheet" href="style.css">
</head>
<body>
	<div>
		<h1>Tec-9</h1>
		<div class="table">
			<h1>Tec-9 | Slag</h1>
			<table>
				<tr>
					<th>skin</th>
					<th>drop rate</th>
					<th>market volume</th>
					<th>average price</th>
					<th>lowest price</th>
					<th>market link</th>
				</tr>
				<tr>
					<td>Tec-9 | Slag (FN)</td>
					<td>future feature</td>
					<td>N/A</td>
					<td>N/A</td>
					<td>N/A</td>
					<td>visit market</td>
				</tr>
				<tr>
					<td>Tec-9 | Slag (MW)</td>
					<td>future feature</td>
					<td>N/A</td>
					<td>N/A</td>
					<td>N/A</td>
					<td>visit market</td>
				</tr>
				<tr>
					<td>Tec-9 | Slag (FT)</td>
					<td>future feature</td>
					<td>N/A</td>
					<td>N/A</td>
					<td>N/A</td>
					<td>visit market</td>
				</tr>
				<tr>
					<td>Tec-9 | Slag (WW)</td>
					<td>future feature</td>
					<td>N/A</td>
					<td>N/A</td>
					<td>N/A</td>
					<td>visit market</td>
				</tr>
				<tr>
					<td>Tec-9 | Slag (BS)</td>
					<td>future feature</td>
					<td>N/A</td>
					<td>N/A</td>
					<td>N/A</td>
					<td>visit market</td>
				</tr>

			</table>
		</div>
	</div>
	<div>
		<h1>Five-SeveN</h1>
		<div class="table">
			<h1>Five-SeveN | Coolant</h1>
			<table>
				<tr>
					<th>skin</th>
					<th>drop rate</th>
					<th>market volume</th>
					<th>average price</th>
					<th>lowest price</th>
					<th>market link</th>
				</tr>
				<tr>
					<td>Five-SeveN | Coolant (FN)</td>
					<td>future feature</td>
					<td>N/A</td>
					<td>N/A</td>
					<td>N/A</td>
					<td>visit market</td>
				</tr>
				<tr>
					<td>Five-SeveN | Coolant (MW)</td>
					<td>future feature</td>
					<td>N/A</td>
					<td>N/A</td>
					<td>N/A</td>
					<td>visit market</td>
				</tr>
				<tr>
					<td>Five-SeveN | Coolant (FT)</td>
					<td>future feature</td>
					<td>N/A</td>
					<td>N/A</td>
					<td>N/A</td>
					<td>visit market</td>
				</tr>
				<tr>
					<td>Five-SeveN | Coolant (WW)</td>
					<td>future feature</td>
					<td>N/A</td>
					<td>N/A</td>
					<td>N/A</td>
					<td>visit market</td>
				</tr>
				<tr>
					<td>Five-SeveN | Coolant (BS)</td>
					<td>future feature</td>
					<td>N/A</td>
					<td>N/A</td>
					<td>N/A</td>
					<td>visit market</td>
				</tr>

			</table>
		</div>
	</div>
	<script>
		const wearMap = {
			"(FN)": "Factory New",
			"(MW)": "Minimal Wear",
			"(FT)": "Field-Tested",
			"(WW)": "Well-Worn",
			"(BS)": "Battle-Scarred"
		};

		const lazyload = new IntersectionObserver((entries, obs) => {

			entries.forEach(async entry => {
				if (!entry.isIntersecting) return;

				const row = entry.target;
				const nameCell = row.cells[0];
				const linkCell = row.cells[5];

				const mv = row.cells[2];
				const mp = row.cells[3];
				const lp = row.cells[4];

				if (nameCell && linkCell) {
					const rawText = nameCell.textContent.trim();
					const match = rawText.match(/\((.*?)\)/);

					if (match) {
						const shortWear = `(${match[1]})`;
						const fullWear = wearMap[shortWear];
						const baseName = rawText.replace(shortWear, "").trim();
						const fullName = `${baseName} (${fullWear})`;

						console.log("Lazy Loading:", fullName);

						const url = `https://steamcommunity.com/market/listings/730/${encodeURIComponent(fullName)}`;
						linkCell.textContent = "Visit Market";
						linkCell.classList.add("button");
						linkCell.dataset.url = url;

						const steamAPI = `https://steamcommunity.com/market/priceoverview/?appid=730&currency=1&market_hash_name=${encodeURIComponent(fullName)}`;
						const cfworkerURL = `https://steam-api-fetch.tizibinki.workers.dev/?url=${encodeURIComponent(steamAPI)}`;

						try {
							const response = await fetch(cfworkerURL);
							const data = await response.json();

							if (data.success) {
								mv.innerText = data.volume || "N/A";
								mp.innerText = data.median_price || "N/A";
								lp.innerText = data.lowest_price || "N/A";
							}
						} catch (err) {
							console.error("API fetch error:", err);
						}

					} else {
						anchor.textContent = "Invalid Name";
						anchor.style.color = "red";
					}
					lazyload.unobserve(row);
				}
			});
		}, {
			root: null,
			rootMargin: "0px 0px 150px 0px",
			threshold: 0.1
		});

		document.querySelectorAll("table tr").forEach(row => {
			if (row.cells.length === 6 && row.cells[0].textContent.includes("|")) {
				lazyload.observe(row);
			}
		});

		document.addEventListener("click", e => {
			const cell = e.target.closest("td[data-url]");
			if (cell) {
				const url = cell.dataset.url;
				if (url) window.open(url, "_blank");
			}
		});
	</script>
</body>
</html>